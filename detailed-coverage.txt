
> medicamenta.me-back-functions@1.0.0 test
> jest --coverage --coverageReporters=lcov --coverageReporters=text

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error reactivating PagSeguro subscription: Error: API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\reactivatePagSeguroSubscription.test.ts:125:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 408 |[39m     } [36mcatch[39m (error) {
     [90m 409 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 410 |[39m       console[33m.[39merror([32m'Error reactivating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 411 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 412 |[39m     }
     [90m 413 |[39m   }[0m

      at error (src/pagseguro-functions.ts:410:15)

  console.error
    Error reactivating PagSeguro subscription: Error: Not found
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\reactivatePagSeguroSubscription.test.ts:139:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 404 }
    }

    [0m [90m 408 |[39m     } [36mcatch[39m (error) {
     [90m 409 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 410 |[39m       console[33m.[39merror([32m'Error reactivating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 411 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 412 |[39m     }
     [90m 413 |[39m   }[0m

      at error (src/pagseguro-functions.ts:410:15)

  console.error
    Error reactivating PagSeguro subscription: Error: Subscription already active
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\reactivatePagSeguroSubscription.test.ts:149:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 400 }
    }

    [0m [90m 408 |[39m     } [36mcatch[39m (error) {
     [90m 409 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 410 |[39m       console[33m.[39merror([32m'Error reactivating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 411 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 412 |[39m     }
     [90m 413 |[39m   }[0m

      at error (src/pagseguro-functions.ts:410:15)

  console.error
    Error reactivating PagSeguro subscription: Error: ETIMEDOUT
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\reactivatePagSeguroSubscription.test.ts:159:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 408 |[39m     } [36mcatch[39m (error) {
     [90m 409 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 410 |[39m       console[33m.[39merror([32m'Error reactivating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 411 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 412 |[39m     }
     [90m 413 |[39m   }[0m

      at error (src/pagseguro-functions.ts:410:15)

  console.error
    Error reactivating PagSeguro subscription: Error: Unauthorized
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\reactivatePagSeguroSubscription.test.ts:167:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 401 }
    }

    [0m [90m 408 |[39m     } [36mcatch[39m (error) {
     [90m 409 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 410 |[39m       console[33m.[39merror([32m'Error reactivating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 411 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 412 |[39m     }
     [90m 413 |[39m   }[0m

      at error (src/pagseguro-functions.ts:410:15)

node.exe : PASS src/__tests__/pagseguro/reactivatePagSeguroSubscription.test.ts (20.969 s)
No linha:1 caractere:1
+ & "C:\Program Files\nodejs/node.exe" "C:\Users\Gabriel\AppData\Roamin ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (PASS src/__test...t.ts (20.969 s):String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  reactivatePagSeguroSubscription
    Cen├írios Positivos
      ΓêÜ should successfully reactivate subscription (11 ms)
      ΓêÜ should call correct PagSeguro API endpoint with credentials (1 ms)
      ΓêÜ should return success message (1 ms)
    Cen├írios Negativos
      ΓêÜ should throw error if user not authenticated (94 ms)
      ΓêÜ should throw error if subscriptionCode is missing (19 ms)
      ΓêÜ should throw error if subscriptionCode is empty (12 ms)
      ΓêÜ should throw error if PagSeguro API fails (20 ms)
    Edge Cases
      ΓêÜ should handle subscription not found (404) (9 ms)
      ΓêÜ should handle already active subscription (400) (33 ms)
      ΓêÜ should handle network timeout (13 ms)
      ΓêÜ should handle unauthorized (401) (5 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    API Error: {
      error: 'grant_type is required',
      stack: 'ApiError: grant_type is required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:33:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'client_id and client_secret are required',
      stack: 'ApiError: client_id and client_secret are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:39:15\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Invalid client credentials',
      stack: 'ApiError: Invalid client credentials\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:51:15\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)

  console.error
    API Error: {
      error: 'Invalid client credentials',
      stack: 'ApiError: Invalid client credentials\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:57:15\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)

  console.error
    API Error: {
      error: 'Client account is suspended',
      stack: 'ApiError: Client account is suspended\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:61:15\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)

  console.error
    API Error: {
      error: 'refresh_token is required',
      stack: 'ApiError: refresh_token is required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:94:15\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Invalid or expired refresh token',
      stack: 'ApiError: Invalid or expired refresh token\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:102:15\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Refresh token has been revoked',
      stack: 'ApiError: Refresh token has been revoked\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:119:15\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)

  console.error
    API Error: {
      error: 'Grant type password is not supported',
      stack: 'ApiError: Grant type password is not supported\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:147:11\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/token',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:150:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    Error creating PagSeguro subscription: HttpsError: User must be authenticated
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\pagseguro-functions.ts:31:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\createPagSeguroSubscription.test.ts:174:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'unauthenticated',
      details: undefined,
      httpErrorCode: { canonicalName: 'UNAUTHENTICATED', status: 401 }
    }

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:174:20)

  console.error
    Error creating PagSeguro subscription: HttpsError: Missing required fields
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\pagseguro-functions.ts:40:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\createPagSeguroSubscription.test.ts:194:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'invalid-argument',
      details: undefined,
      httpErrorCode: { canonicalName: 'INVALID_ARGUMENT', status: 400 }
    }

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:194:20)

  console.error
    API Error: {
      error: 'token is required',
      stack: 'ApiError: token is required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:163:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/revoke',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/auth.routes.ts:183:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    Error creating PagSeguro subscription: HttpsError: Missing required fields
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\pagseguro-functions.ts:40:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\createPagSeguroSubscription.test.ts:214:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'invalid-argument',
      details: undefined,
      httpErrorCode: { canonicalName: 'INVALID_ARGUMENT', status: 400 }
    }

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:214:20)

  console.error
    API Error: {
      error: 'Client credentials required',
      stack: 'ApiError: Client credentials required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:200:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/auth/api-key',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Invalid credentials',
      stack: 'ApiError: Invalid credentials\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:208:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/api-key',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    Error creating PagSeguro subscription: AxiosError {
      message: 'Request failed with status code 400',
      name: 'AxiosError',
      code: 'ERR_BAD_REQUEST',
      config: {
        transitional: {
          silentJSONParsing: true,
          forcedJSONParsing: true,
          clarifyTimeoutError: false
        },
        adapter: [ 'xhr', 'http', 'fetch' ],
        transformRequest: [ [Function: transformRequest] ],
        transformResponse: [ [Function: transformResponse] ],
        timeout: 0,
        xsrfCookieName: 'XSRF-TOKEN',
        xsrfHeaderName: 'X-XSRF-TOKEN',
        maxContentLength: -1,
        maxBodyLength: -1,
        env: { FormData: [Function [FormData]], Blob: [class Blob] },
        validateStatus: [Function: validateStatus],
        headers: Object [AxiosHeaders] {
          Accept: 'application/json, text/plain, */*',
          'Content-Type': 'application/xml; charset=UTF-8',
          'User-Agent': 'axios/1.13.2',
          'Content-Length': '380',
          'Accept-Encoding': 'gzip, compress, deflate, br'
        },
        method: 'post',
        url: 'https://ws.sandbox.pagseguro.uol.com.br/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
        data: '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
          '<preApprovalRequest>\n' +
          '    <reference>test-user-pagseguro-123</reference>\n' +
          '    <plan>INVALID</plan>\n' +
          '    <sender>\n' +
          '        <name>Test User</name>\n' +
          '        <email>test@example.com</email>\n' +
          '        <phone>\n' +
          '            <areaCode>11</areaCode>\n' +
          '            <number>999999999</number>\n' +
          '        </phone>\n' +
          '    </sender>\n' +
          '</preApprovalRequest>',
        allowAbsoluteUrls: true
      },
      request: <ref *1> ClientRequest {
        _events: [Object: null prototype] {
          abort: [Function (anonymous)],
          aborted: [Function (anonymous)],
          connect: [Function (anonymous)],
          error: [Function (anonymous)],
          socket: [Function (anonymous)],
          timeout: [Function (anonymous)],
          finish: [Function: requestOnFinish]
        },
        _eventsCount: 7,
        _maxListeners: undefined,
        outputData: [],
        outputSize: 0,
        writable: true,
        destroyed: true,
        _last: true,
        chunkedEncoding: false,
        shouldKeepAlive: false,
        maxRequestsOnConnectionReached: false,
        _defaultKeepAlive: true,
        useChunkedEncodingByDefault: true,
        sendDate: false,
        _removedConnection: false,
        _removedContLen: false,
        _removedTE: false,
        strictContentLength: false,
        _contentLength: 380,
        _hasBody: true,
        _trailer: '',
        finished: true,
        _headerSent: true,
        _closed: true,
        _header: 'POST /pre-approvals/request?email=test@pagseguro.com&token=test-token-123456 HTTP/1.1\r\n' +
          'Accept: application/json, text/plain, */*\r\n' +
          'Content-Type: application/xml; charset=UTF-8\r\n' +
          'User-Agent: axios/1.13.2\r\n' +
          'Content-Length: 380\r\n' +
          'Accept-Encoding: gzip, compress, deflate, br\r\n' +
          'Host: ws.sandbox.pagseguro.uol.com.br\r\n' +
          'Connection: close\r\n' +
          '\r\n',
        _keepAliveTimeout: 0,
        _onPendingData: [Function: nop],
        agent: MockHttpsAgent {
          _events: [Object: null prototype],
          _eventsCount: 2,
          _maxListeners: undefined,
          options: [Object: null prototype],
          defaultPort: 443,
          protocol: 'https:',
          requests: [Object: null prototype] {},
          sockets: [Object: null prototype] {},
          freeSockets: [Object: null prototype] {},
          keepAliveMsecs: 1000,
          keepAlive: false,
          maxSockets: Infinity,
          maxFreeSockets: 256,
          scheduling: 'lifo',
          maxTotalSockets: Infinity,
          totalSocketCount: 0,
          maxCachedSessions: 100,
          _sessionCache: [Object],
          customAgent: undefined,
          onRequest: [Function: bound ] AsyncFunction,
          onResponse: [Function: bound ] AsyncFunction,
          Symbol(shapeMode): false,
          Symbol(kCapture): false
        },
        socketPath: undefined,
        method: 'POST',
        maxHeaderSize: undefined,
        insecureHTTPParser: undefined,
        joinDuplicateHeaders: undefined,
        path: '/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
        _ended: true,
        res: IncomingMessage {
          _events: [Object],
          _readableState: [ReadableState],
          _maxListeners: undefined,
          socket: [MockHttpSocket],
          httpVersionMajor: 1,
          httpVersionMinor: 1,
          httpVersion: '1.1',
          complete: true,
          rawHeaders: [],
          rawTrailers: [],
          joinDuplicateHeaders: undefined,
          aborted: false,
          upgrade: false,
          url: '',
          method: null,
          statusCode: 400,
          statusMessage: 'Bad Request',
          client: [MockHttpSocket],
          _consuming: true,
          _dumped: false,
          req: [Circular *1],
          _eventsCount: 4,
          responseUrl: 'https://ws.sandbox.pagseguro.uol.com.br/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
          redirects: [],
          Symbol(shapeMode): true,
          Symbol(kCapture): false,
          Symbol(kHeaders): {},
          Symbol(kHeadersCount): 0,
          Symbol(kTrailers): null,
          Symbol(kTrailersCount): 0
        },
        aborted: false,
        timeoutCb: null,
        upgradeOrConnect: false,
        parser: null,
        maxHeadersCount: null,
        reusedSocket: false,
        host: 'ws.sandbox.pagseguro.uol.com.br',
        protocol: 'https:',
        _redirectable: Writable {
          _events: [Object],
          _writableState: [WritableState],
          _maxListeners: undefined,
          _options: [Object],
          _ended: true,
          _ending: true,
          _redirectCount: 0,
          _redirects: [],
          _requestBodyLength: 380,
          _requestBodyBuffers: [],
          _eventsCount: 3,
          _onNativeResponse: [Function (anonymous)],
          _currentRequest: [Circular *1],
          _currentUrl: 'https://ws.sandbox.pagseguro.uol.com.br/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
          _timeout: null,
          Symbol(shapeMode): true,
          Symbol(kCapture): false
        },
        Symbol(shapeMode): false,
        Symbol(kCapture): false,
        Symbol(kBytesWritten): 0,
        Symbol(kNeedDrain): false,
        Symbol(corked): 0,
        Symbol(kChunkedBuffer): [],
        Symbol(kChunkedLength): 0,
        Symbol(kSocket): MockHttpSocket {
          connecting: false,
          _hadError: false,
          _parent: null,
          _host: null,
          _closeAfterHandlingError: false,
          _events: [Object],
          _readableState: [ReadableState],
          _writableState: [WritableState],
          allowHalfOpen: false,
          _maxListeners: undefined,
          _eventsCount: 9,
          _sockname: null,
          _pendingData: null,
          _pendingEncoding: '',
          server: null,
          _server: null,
          options: [Object],
          _final: [Function (anonymous)],
          requestRawHeadersBuffer: [],
          responseRawHeadersBuffer: [],
          writeBuffer: [Array],
          socketState: 'mock',
          onRequestHeaders: [Function (anonymous)],
          onRequestStart: [Function (anonymous)],
          onResponseHeaders: [Function (anonymous)],
          onResponseStart: [Function (anonymous)],
          connectionOptions: [Object: null prototype],
          createConnection: [Function: bound createConnection],
          onRequest: [Function: bound bound ] AsyncFunction,
          onResponse: [Function: bound bound ] AsyncFunction,
          baseUrl: URL {},
          requestParser: [HTTPParser],
          responseParser: [HTTPParser],
          encrypted: true,
          authorized: false,
          getProtocol: [Function (anonymous)],
          getSession: [Function (anonymous)],
          isSessionReused: [Function (anonymous)],
          parser: null,
          _httpMessage: [Circular *1],
          timeout: 0,
          shouldKeepAlive: false,
          requestStream: [Readable],
          request: Request {
            method: 'POST',
            url: 'https://ws.sandbox.pagseguro.uol.com.br/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
            headers: Headers {
              Accept: 'application/json, text/plain, */*',
              'Content-Type': 'application/xml; charset=UTF-8',
              'User-Agent': 'axios/1.13.2',
              'Content-Length': '380',
              'Accept-Encoding': 'gzip, compress, deflate, br',
              Host: 'ws.sandbox.pagseguro.uol.com.br',
              Connection: 'close'
            },
            destination: '',
            referrer: 'about:client',
            referrerPolicy: '',
            mode: 'cors',
            credentials: 'same-origin',
            cache: 'default',
            redirect: 'follow',
            integrity: '',
            keepalive: false,
            isReloadNavigation: false,
            isHistoryNavigation: false,
            signal: AbortSignal { aborted: false }
          },
          address: [Function (anonymous)],
          responseStream: [Readable],
          responseListenersPromise: [Promise],
          write: [Function: writeAfterFIN],
          Symbol(async_id_symbol): -1,
          Symbol(kHandle): null,
          Symbol(lastWriteQueueSize): 0,
          Symbol(timeout): null,
          Symbol(kBuffer): null,
          Symbol(kBufferCb): null,
          Symbol(kBufferGen): null,
          Symbol(shapeMode): true,
          Symbol(kCapture): false,
          Symbol(kSetNoDelay): false,
          Symbol(kSetKeepAlive): true,
          Symbol(kSetKeepAliveInitialDelay): 60,
          Symbol(kBytesRead): 0,
          Symbol(kBytesWritten): 0
        },
        Symbol(kOutHeaders): [Object: null prototype] {
          accept: [Array],
          'content-type': [Array],
          'user-agent': [Array],
          'content-length': [Array],
          'accept-encoding': [Array],
          host: [Array]
        },
        Symbol(errored): null,
        Symbol(kHighWaterMark): 16384,
        Symbol(kRejectNonStandardBodyWrites): false,
        Symbol(kUniqueHeaders): null
      },
      response: {
        status: 400,
        statusText: 'Bad Request',
        headers: Object [AxiosHeaders] {},
        config: {
          transitional: [Object],
          adapter: [Array],
          transformRequest: [Array],
          transformResponse: [Array],
          timeout: 0,
          xsrfCookieName: 'XSRF-TOKEN',
          xsrfHeaderName: 'X-XSRF-TOKEN',
          maxContentLength: -1,
          maxBodyLength: -1,
          env: [Object],
          validateStatus: [Function: validateStatus],
          headers: [Object [AxiosHeaders]],
          method: 'post',
          url: 'https://ws.sandbox.pagseguro.uol.com.br/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
          data: '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
            '<preApprovalRequest>\n' +
            '    <reference>test-user-pagseguro-123</reference>\n' +
            '    <plan>INVALID</plan>\n' +
            '    <sender>\n' +
            '        <name>Test User</name>\n' +
            '        <email>test@example.com</email>\n' +
            '        <phone>\n' +
            '            <areaCode>11</areaCode>\n' +
            '            <number>999999999</number>\n' +
            '        </phone>\n' +
            '    </sender>\n' +
            '</preApprovalRequest>',
          allowAbsoluteUrls: true
        },
        request: <ref *1> ClientRequest {
          _events: [Object: null prototype],
          _eventsCount: 7,
          _maxListeners: undefined,
          outputData: [],
          outputSize: 0,
          writable: true,
          destroyed: true,
          _last: true,
          chunkedEncoding: false,
          shouldKeepAlive: false,
          maxRequestsOnConnectionReached: false,
          _defaultKeepAlive: true,
          useChunkedEncodingByDefault: true,
          sendDate: false,
          _removedConnection: false,
          _removedContLen: false,
          _removedTE: false,
          strictContentLength: false,
          _contentLength: 380,
          _hasBody: true,
          _trailer: '',
          finished: true,
          _headerSent: true,
          _closed: true,
          _header: 'POST /pre-approvals/request?email=test@pagseguro.com&token=test-token-123456 HTTP/1.1\r\n' +
            'Accept: application/json, text/plain, */*\r\n' +
            'Content-Type: application/xml; charset=UTF-8\r\n' +
            'User-Agent: axios/1.13.2\r\n' +
            'Content-Length: 380\r\n' +
            'Accept-Encoding: gzip, compress, deflate, br\r\n' +
            'Host: ws.sandbox.pagseguro.uol.com.br\r\n' +
            'Connection: close\r\n' +
            '\r\n',
          _keepAliveTimeout: 0,
          _onPendingData: [Function: nop],
          agent: [MockHttpsAgent],
          socketPath: undefined,
          method: 'POST',
          maxHeaderSize: undefined,
          insecureHTTPParser: undefined,
          joinDuplicateHeaders: undefined,
          path: '/pre-approvals/request?email=test@pagseguro.com&token=test-token-123456',
          _ended: true,
          res: [IncomingMessage],
          aborted: false,
          timeoutCb: null,
          upgradeOrConnect: false,
          parser: null,
          maxHeadersCount: null,
          reusedSocket: false,
          host: 'ws.sandbox.pagseguro.uol.com.br',
          protocol: 'https:',
          _redirectable: [Writable],
          Symbol(shapeMode): false,
          Symbol(kCapture): false,
          Symbol(kBytesWritten): 0,
          Symbol(kNeedDrain): false,
          Symbol(corked): 0,
          Symbol(kChunkedBuffer): [],
          Symbol(kChunkedLength): 0,
          Symbol(kSocket): [MockHttpSocket],
          Symbol(kOutHeaders): [Object: null prototype],
          Symbol(errored): null,
          Symbol(kHighWaterMark): 16384,
          Symbol(kRejectNonStandardBodyWrites): false,
          Symbol(kUniqueHeaders): null
        },
        data: '<?xml version="1.0" encoding="UTF-8"?>\n' +
          '          <errors>\n' +
          '            <error>\n' +
          '              <code>11013</code>\n' +
          '              <message>Invalid plan code</message>\n' +
          '            </error>\n' +
          '          </errors>'
      },
      status: 400
    }

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:252:7)

  console.error
    API Error: {
      error: 'Invalid credentials',
      stack: 'ApiError: Invalid credentials\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\auth.routes.ts:208:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/auth/api-key',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

PASS src/api/v1/__tests__/auth.routes.test.ts (23.965 s)
  ≡ƒöÉ Auth Routes - Integration Tests
    POST /v1/auth/token
      Γ£à Client Credentials Flow
        ΓêÜ deve gerar tokens com credenciais v├ílidas (257 ms)
        ΓêÜ deve retornar 400 se grant_type n├úo for fornecido (40 ms)
        ΓêÜ deve retornar 400 se client_id ou client_secret faltando (17 ms)
        ΓêÜ deve retornar 401 se partner n├úo existe (38 ms)
        ΓêÜ deve retornar 401 se client_secret incorreto (34 ms)
        ΓêÜ deve retornar 403 se partner est├í suspenso (72 ms)
      Γ£à Refresh Token Flow
        ΓêÜ deve gerar novo access token com refresh token v├ílido (106 ms)
        ΓêÜ deve retornar 400 se refresh_token n├úo fornecido (33 ms)
        ΓêÜ deve retornar 401 se refresh token inv├ílido (14 ms)
        ΓêÜ deve retornar 401 se refresh token foi revogado (259 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 para grant_type n├úo suportado (14 ms)
    POST /v1/auth/revoke
      Γ£à Cen├írios Positivos
        ΓêÜ deve revogar refresh token existente (130 ms)
        ΓêÜ deve retornar sucesso mesmo se token n├úo existe (25 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se token n├úo fornecido (12 ms)
    POST /v1/auth/api-key
      Γ£à Cen├írios Positivos
        ΓêÜ deve gerar API key com credenciais v├ílidas (44 ms)
        ΓêÜ deve usar valores padr├úo se n├úo fornecidos (42 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 401 se credenciais n├úo fornecidas (10 ms)
        ΓêÜ deve retornar 401 se partner n├úo existe (27 ms)
        ΓêÜ deve retornar 401 se client_secret incorreto (25 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    Γ£à Checkout completed for user test-user-webhook-123, plan: premium

      at log (src/stripe-functions.ts:177:11)

  console.error
    Missing metadata in checkout session

    [0m [90m 155 |[39m
     [90m 156 |[39m   [36mif[39m ([33m![39muserId [33m||[39m [33m![39mplan) {
    [31m[1m>[22m[39m[90m 157 |[39m     console[33m.[39merror([32m'Missing metadata in checkout session'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 158 |[39m     [36mreturn[39m[33m;[39m
     [90m 159 |[39m   }
     [90m 160 |[39m[0m

      at error (src/stripe-functions.ts:157:13)
      at handleCheckoutSessionCompleted (src/stripe-functions.ts:117:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at node_modules/firebase-functions/lib/v2/trace.js:16:28
      at cloudFunction (node_modules/firebase-functions/lib/v1/providers/https.js:53:78)
      at Object.<anonymous> (src/__tests__/stripe/stripeWebhook.test.ts:174:26)

  console.log
    Γ£à Subscription updated for user test-user-webhook-123, status: active

      at log (src/stripe-functions.ts:200:11)

  console.log
    Γ£à Subscription updated for user test-user-webhook-123, status: active

      at log (src/stripe-functions.ts:200:11)

  console.log
    Γ£à Subscription deleted for user test-user-webhook-123

      at log (src/stripe-functions.ts:220:11)

  console.log
    Γ£à Invoice paid for user test-user-webhook-123

      at log (src/stripe-functions.ts:257:11)

  console.log
    Γ¥î Payment failed for user test-user-webhook-123

      at log (src/stripe-functions.ts:288:11)

  console.error
    Webhook signature verification failed: Error: Invalid signature
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\stripeWebhook.test.ts:484:15)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-mock\build\index.js:305:39
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-mock\build\index.js:312:13)
        at Object.mockConstructor [as constructEvent] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-mock\build\index.js:102:19)
        at constructEvent (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\stripe-functions.ts:106:29)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v2\trace.js:16:28
        at cloudFunction (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:53:78)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\stripeWebhook.test.ts:501:26)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 106 |[39m     event [33m=[39m stripe[33m.[39mwebhooks[33m.[39mconstructEvent(req[33m.[39mrawBody[33m,[39m sig[33m,[39m webhookSecret)[33m;[39m
     [90m 107 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 108 |[39m     console[33m.[39merror([32m'Webhook signature verification failed:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 109 |[39m     res[33m.[39mstatus([35m400[39m)[33m.[39msend([32m`Webhook Error: ${error?.message || 'Unknown error'}`[39m)[33m;[39m
     [90m 110 |[39m     [36mreturn[39m[33m;[39m
     [90m 111 |[39m   }[0m

      at error (src/stripe-functions.ts:108:13)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at node_modules/firebase-functions/lib/v2/trace.js:16:28
      at cloudFunction (node_modules/firebase-functions/lib/v1/providers/https.js:53:78)
      at Object.<anonymous> (src/__tests__/stripe/stripeWebhook.test.ts:501:26)

  console.log
    Unhandled event type: unknown.event.type

      at log (src/stripe-functions.ts:138:17)

  console.error
    User not found for customer: cus_nonexistent

    [0m [90m 236 |[39m
     [90m 237 |[39m   [36mif[39m (userSnapshot[33m.[39mempty) {
    [31m[1m>[22m[39m[90m 238 |[39m     console[33m.[39merror([32m'User not found for customer:'[39m[33m,[39m customerId)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 239 |[39m     [36mreturn[39m[33m;[39m
     [90m 240 |[39m   }
     [90m 241 |[39m[0m

      at error (src/stripe-functions.ts:238:13)
      at src/stripe-functions.ts:130:9
      at Object.<anonymous> (src/__tests__/stripe/stripeWebhook.test.ts:568:7)

  console.error
    Error processing webhook: Error: Stripe API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\stripeWebhook.test.ts:595:57)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 141 |[39m     res[33m.[39mjson({ received[33m:[39m [36mtrue[39m })[33m;[39m
     [90m 142 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 143 |[39m     console[33m.[39merror([32m'Error processing webhook:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 144 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39msend([32m`Webhook Error: ${error?.message || 'Unknown error'}`[39m)[33m;[39m
     [90m 145 |[39m   }
     [90m 146 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:143:13)
      at Object.<anonymous> (src/__tests__/stripe/stripeWebhook.test.ts:611:7)

PASS src/__tests__/stripe/stripeWebhook.test.ts (7.22 s)
  ≡ƒö╡ Stripe Functions - stripeWebhook
    Γ£à checkout.session.completed
      ΓêÜ deve processar checkout session completed (1922 ms)
      ΓêÜ deve lidar com checkout session sem metadata (60 ms)
    Γ£à customer.subscription.created/updated
      ΓêÜ deve processar subscription created (99 ms)
      ΓêÜ deve processar subscription updated com cancel_at_period_end (130 ms)
    Γ£à customer.subscription.deleted
      ΓêÜ deve processar subscription deleted (89 ms)
    Γ£à invoice.paid
      ΓêÜ deve processar invoice paid e resetar contadores (165 ms)
    Γ£à invoice.payment_failed
      ΓêÜ deve processar invoice payment failed (126 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro 400 se assinatura do webhook inv├ílida (62 ms)
      ΓêÜ deve ignorar eventos n├úo reconhecidos (45 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com usu├írio n├úo encontrado em invoice.paid (69 ms)
      ΓêÜ deve lidar com falha ao buscar subscription do Stripe (42 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:29:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/nonexistent-patient-id',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/adherence.routes.ts:82:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:33:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/other-patient-1766164167234',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/adherence.routes.ts:82:5)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:101:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/nonexistent-patient-id/history',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/adherence.routes.ts:140:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:105:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/other-patient-history-1766164167479/history',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/adherence.routes.ts:140:5)

  console.error
    API Error: {
      error: 'patientId, medicationId, and scheduledTime are required',
      stack: 'ApiError: patientId, medicationId, and scheduledTime are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:154:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\adherence.routes.test.ts:26:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'patientId, medicationId, and scheduledTime are required',
      stack: 'ApiError: patientId, medicationId, and scheduledTime are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:154:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\adherence.routes.test.ts:26:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'patientId, medicationId, and scheduledTime are required',
      stack: 'ApiError: patientId, medicationId, and scheduledTime are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:154:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\adherence.routes.test.ts:26:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:166:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Medication not found',
      stack: 'ApiError: Medication not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:178:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:170:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\adherence.routes.ts:182:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/adherence/confirm',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

PASS src/api/v1/__tests__/adherence.routes.test.ts (5.413 s)
  ≡ƒôè Adherence Routes - Integration Tests
    GET /v1/adherence/:patientId
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar m├⌐tricas de ader├¬ncia do paciente (151 ms)
        ΓêÜ deve filtrar por medica├º├úo espec├¡fica (49 ms)
        ΓêÜ deve filtrar por per├¡odo de datas (71 ms)
        ΓêÜ deve incluir breakdown por medica├º├úo (67 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se paciente n├úo existe (39 ms)
        ΓêÜ deve retornar 403 se tentar acessar paciente de outro parceiro (39 ms)
    GET /v1/adherence/:patientId/history
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar hist├│rico de doses do paciente (53 ms)
        ΓêÜ deve filtrar por status (49 ms)
        ΓêÜ deve filtrar por medica├º├úo (45 ms)
        ΓêÜ deve respeitar pagina├º├úo (38 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se paciente n├úo existe (21 ms)
        ΓêÜ deve retornar 403 se tentar acessar hist├│rico de outro parceiro (26 ms)
    POST /v1/adherence/confirm
      Γ£à Cen├írios Positivos
        ΓêÜ deve confirmar dose tomada com dados completos (64 ms)
        ΓêÜ deve confirmar dose com dados m├¡nimos (40 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se patientId est├í faltando (10 ms)
        ΓêÜ deve retornar 400 se medicationId est├í faltando (11 ms)
        ΓêÜ deve retornar 400 se scheduledTime est├í faltando (10 ms)
        ΓêÜ deve retornar 404 se paciente n├úo existe (31 ms)
        ΓêÜ deve retornar 404 se medica├º├úo n├úo existe (49 ms)
        ΓêÜ deve retornar 403 se tentar confirmar dose para paciente de outro parceiro (47 ms)
        ΓêÜ deve retornar 403 se tentar confirmar dose com medica├º├úo de outro parceiro (71 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    API Error: {
      error: 'url and events (array) are required',
      stack: 'ApiError: url and events (array) are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:25:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\webhooks.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/webhooks',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:91:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/webhooks.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'url and events (array) are required',
      stack: 'ApiError: url and events (array) are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:25:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\webhooks.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/webhooks',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:91:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/webhooks.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Invalid webhook URL',
      stack: 'ApiError: Invalid webhook URL\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:36:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\webhooks.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/webhooks',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:91:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/webhooks.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Invalid events: invalid.event, another.invalid',
      stack: 'ApiError: Invalid events: invalid.event, another.invalid\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:56:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\webhooks.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/webhooks',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:91:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/webhooks.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Webhook not found',
      stack: 'ApiError: Webhook not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:136:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/nonexistent-webhook-id',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:150:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:142:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/kukod8XdLTM2410EqqxM',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:150:5)

  console.error
    API Error: {
      error: 'Webhook not found',
      stack: 'ApiError: Webhook not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:167:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/nonexistent-webhook-id',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:180:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:173:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/xvsgVMXgMMdIq5RuELH0',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/webhooks.routes.ts:180:5)

  console.error
    API Error: {
      error: 'name and dateOfBirth are required',
      stack: 'ApiError: name and dateOfBirth are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:36:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\patients.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/patients',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:78:21)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/patients.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'name and dateOfBirth are required',
      stack: 'ApiError: name and dateOfBirth are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:36:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\patients.routes.test.ts:24:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/patients',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:78:21)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/patients.routes.test.ts:24:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:94:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/nonexistent-id',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:108:21)

  console.error
    API Error: {
      error: 'Access denied to this patient',
      stack: 'ApiError: Access denied to this patient\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:101:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/TYd3S1vv2Lk5mhEtJr8j',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:108:21)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:174:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/nonexistent-id',
      method: 'PATCH',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:229:21)

  console.error
    API Error: {
      error: 'Access denied to this patient',
      stack: 'ApiError: Access denied to this patient\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:181:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/tS1N4f2uopXPoK6VO5tb',
      method: 'PATCH',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:229:21)

  console.error
    API Error: {
      error: 'No valid fields to update',
      stack: 'ApiError: No valid fields to update\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:207:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/uRNCGZjDRyIQu4e1ceXS',
      method: 'PATCH',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/patients.routes.ts:229:21)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:246:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/nonexistent-id',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Access denied to this patient',
      stack: 'ApiError: Access denied to this patient\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\patients.routes.ts:253:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/patients/mYYZQtfAIeccQI6XyTVN',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Webhook not found',
      stack: 'ApiError: Webhook not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:197:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/nonexistent-webhook-id/test',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\webhooks.routes.ts:203:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/webhooks/R9Ga7qdRPYWMl1NqJBvM/test',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

PASS src/api/v1/__tests__/patients.routes.test.ts
  ≡ƒæñ Patients Routes - Integration Tests
    POST /v1/patients
      Γ£à Cen├írios Positivos
        ΓêÜ deve criar paciente com dados completos (1148 ms)
        ΓêÜ deve criar paciente com dados m├¡nimos obrigat├│rios (22 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se name est├í faltando (26 ms)
        ΓêÜ deve retornar 400 se dateOfBirth est├í faltando (18 ms)
    GET /v1/patients/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar paciente espec├¡fico por ID (30 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se paciente n├úo existe (29 ms)
        ΓêÜ deve retornar 403 se tentar acessar paciente de outro parceiro (48 ms)
    GET /v1/patients
      Γ£à Cen├írios Positivos
        ΓêÜ deve listar pacientes do parceiro (32 ms)
        ΓêÜ deve filtrar pacientes por status (26 ms)
        ΓêÜ deve buscar pacientes por nome (search) (38 ms)
        ΓêÜ deve respeitar pagina├º├úo (24 ms)
    PATCH /v1/patients/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve atualizar dados do paciente (31 ms)
        ΓêÜ deve atualizar apenas campos fornecidos (34 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se paciente n├úo existe (19 ms)
        ΓêÜ deve retornar 403 se tentar atualizar paciente de outro parceiro (31 ms)
        ΓêÜ deve retornar 400 se nenhum campo v├ílido para atualizar (15 ms)
    DELETE /v1/patients/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve deletar paciente (soft delete) (31 ms)
        ΓêÜ deve deletar permanentemente com hard=true (43 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se paciente n├úo existe (26 ms)
        ΓêÜ deve retornar 403 se tentar deletar paciente de outro parceiro (34 ms)

PASS src/api/v1/__tests__/webhooks.routes.test.ts
  ≡ƒöö Webhooks Routes - Integration Tests
    POST /v1/webhooks
      Γ£à Cen├írios Positivos
        ΓêÜ deve criar webhook com dados completos (1032 ms)
        ΓêÜ deve gerar secret automaticamente se n├úo fornecido (20 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se url est├í faltando (32 ms)
        ΓêÜ deve retornar 400 se events est├í faltando (17 ms)
        ΓêÜ deve retornar 400 se URL ├⌐ inv├ílida (20 ms)
        ΓêÜ deve retornar 400 se eventos s├úo inv├ílidos (14 ms)
    GET /v1/webhooks
      Γ£à Cen├írios Positivos
        ΓêÜ deve listar webhooks do parceiro (62 ms)
        ΓêÜ n├úo deve expor secrets na listagem (24 ms)
    GET /v1/webhooks/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar webhook espec├¡fico (57 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se webhook n├úo existe (65 ms)
        ΓêÜ deve retornar 403 se tentar acessar webhook de outro parceiro (56 ms)
    DELETE /v1/webhooks/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve deletar webhook (116 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se webhook n├úo existe (29 ms)
        ΓêÜ deve retornar 403 se tentar deletar webhook de outro parceiro (34 ms)
    POST /v1/webhooks/:id/test
      Γ£à Cen├írios Positivos
        ΓêÜ deve enviar webhook de teste (566 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se webhook n├úo existe (29 ms)
        ΓêÜ deve retornar 403 se tentar testar webhook de outro parceiro (43 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/__tests__/index.test.ts
  API Gateway
    Γ£à Health Check & Info
      ΓêÜ GET /health deve retornar status healthy (31 ms)
      ΓêÜ GET / deve retornar informa├º├╡es da API (11 ms)
    Γ£à Documentation Routes
      ΓêÜ GET /docs deve redirecionar para /api-docs (8 ms)
      ΓêÜ GET /api-docs deve retornar HTML do Swagger UI (14 ms)
      ΓêÜ GET /openapi.json deve retornar especifica├º├úo OpenAPI (17 ms)
    Γ£à API v1 Routes - Public
      ΓêÜ POST /v1/auth/token deve estar acess├¡vel sem autentica├º├úo (14 ms)
    Γ£à API v1 Routes - Protected
      ΓêÜ GET /v1/patients deve existir (com middlewares mockados) (8 ms)
      ΓêÜ GET /v1/medications deve existir (com middlewares mockados) (7 ms)
      ΓêÜ GET /v1/adherence deve existir (com middlewares mockados) (6 ms)
      ΓêÜ GET /v1/reports deve existir (com middlewares mockados) (7 ms)
      ΓêÜ GET /v1/webhooks deve existir (com middlewares mockados) (6 ms)
    Γ¥î 404 Handler
      ΓêÜ deve retornar 404 para rota inexistente (8 ms)
      ΓêÜ deve retornar 404 para rota v1 inexistente (7 ms)
      ΓêÜ deve retornar 404 para POST em rota inexistente (9 ms)
      ΓêÜ deve retornar 404 para DELETE em rota inexistente (7 ms)
      ΓêÜ deve incluir requestId no erro 404 se fornecido (26 ms)
    Γ£à Middleware Configuration
      ΓêÜ deve aceitar JSON no body (6 ms)
      ΓêÜ deve aceitar URL encoded no body (14 ms)
      ΓêÜ deve incluir headers CORS (8 ms)
      ΓêÜ deve incluir security headers (helmet) (11 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com rota raiz com trailing slash (10 ms)
      ΓêÜ deve lidar com query parameters em rotas inexistentes (6 ms)
      ΓêÜ deve lidar com caracteres especiais na URL (7 ms)
      ΓêÜ deve lidar com body muito grande (pr├│ximo ao limite) (123 ms)
      ΓêÜ deve incluir uptime positivo no health check (8 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    API Error: {
      error: 'patientId, name, dosage, and frequency are required',
      stack: 'ApiError: patientId, name, dosage, and frequency are required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:39:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\medications.routes.test.ts:25:5)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/medications',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:90:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at mockAuthMiddleware (src/api/v1/__tests__/medications.routes.test.ts:25:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    API Error: {
      error: 'Patient not found',
      stack: 'ApiError: Patient not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:51:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:90:5)

  console.error
    API Error: {
      error: 'Access denied to this patient',
      stack: 'ApiError: Access denied to this patient\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:55:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:90:5)

  console.error
    API Error: {
      error: 'Medication not found',
      stack: 'ApiError: Medication not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:152:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/nonexistent-id',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:166:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:158:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/6zY4aFyi90QJWuRNmklI',
      method: 'GET',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:166:5)

  console.error
    API Error: {
      error: 'Medication not found',
      stack: 'ApiError: Medication not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:183:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/nonexistent-id',
      method: 'PATCH',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:224:5)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:189:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/G2F2LSYPsJrOZiVv1NNl',
      method: 'PATCH',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at next (src/api/v1/medications.routes.ts:224:5)

  console.error
    API Error: {
      error: 'Medication not found',
      stack: 'ApiError: Medication not found\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:241:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/nonexistent-id',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Access denied',
      stack: 'ApiError: Access denied\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\medications.routes.ts:247:13\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:105:5)',
      path: '/v1/medications/00ms5u37Ibkjrv7PAYuK',
      method: 'DELETE',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

PASS src/api/v1/__tests__/medications.routes.test.ts
  ≡ƒÆè Medications Routes - Integration Tests
    POST /v1/medications
      Γ£à Cen├írios Positivos
        ΓêÜ deve criar medica├º├úo com dados completos (78 ms)
        ΓêÜ deve criar medica├º├úo com dados m├¡nimos (35 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se campos obrigat├│rios faltando (26 ms)
        ΓêÜ deve retornar 404 se paciente n├úo existe (29 ms)
        ΓêÜ deve retornar 403 se tentar criar medica├º├úo para paciente de outro parceiro (42 ms)
    GET /v1/medications
      Γ£à Cen├írios Positivos
        ΓêÜ deve listar medica├º├╡es do parceiro (37 ms)
        ΓêÜ deve filtrar medica├º├╡es por patientId (34 ms)
        ΓêÜ deve filtrar medica├º├╡es por status (30 ms)
        ΓêÜ deve respeitar pagina├º├úo (35 ms)
    GET /v1/medications/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar medica├º├úo espec├¡fica (26 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se medica├º├úo n├úo existe (32 ms)
        ΓêÜ deve retornar 403 se tentar acessar medica├º├úo de outro parceiro (56 ms)
    PATCH /v1/medications/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve atualizar medica├º├úo (49 ms)
        ΓêÜ deve atualizar apenas campos fornecidos (70 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se medica├º├úo n├úo existe (18 ms)
        ΓêÜ deve retornar 403 se tentar atualizar medica├º├úo de outro parceiro (68 ms)
    DELETE /v1/medications/:id
      Γ£à Cen├írios Positivos
        ΓêÜ deve deletar medica├º├úo (soft delete) (42 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 404 se medica├º├úo n├úo existe (26 ms)
        ΓêÜ deve retornar 403 se tentar deletar medica├º├úo de outro parceiro (110 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.log
    [Cloud Vision OCR] Γ£à Success - Text length: 63, Confidence: 95.00%

      at log (src/ocr-cloud-vision.ts:147:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.log
    [Cloud Vision OCR] Γ£à Success - Text length: 17, Confidence: 95.00%

      at log (src/ocr-cloud-vision.ts:147:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.log
    [Cloud Vision OCR] Γ£à Success - Text length: 9, Confidence: 0.00%

      at log (src/ocr-cloud-vision.ts:147:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.error
    [Cloud Vision OCR] Γ¥î Error: Error: Cloud Vision API Error: Quota exceeded
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\ocr\processImageWithCloudVision.test.ts:295:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 155 |[39m
     [90m 156 |[39m     } [36mcatch[39m (error[33m:[39m unknown) {
    [31m[1m>[22m[39m[90m 157 |[39m       console[33m.[39merror([32m'[Cloud Vision OCR] Γ¥î Error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 158 |[39m
     [90m 159 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 160 |[39m[0m

      at error (src/ocr-cloud-vision.ts:157:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.error
    [Cloud Vision OCR] Γ¥î Error: Error: Cloud Vision API Error: Quota exceeded
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\ocr\processImageWithCloudVision.test.ts:295:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 155 |[39m
     [90m 156 |[39m     } [36mcatch[39m (error[33m:[39m unknown) {
    [31m[1m>[22m[39m[90m 157 |[39m       console[33m.[39merror([32m'[Cloud Vision OCR] Γ¥î Error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 158 |[39m
     [90m 159 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 160 |[39m[0m

      at error (src/ocr-cloud-vision.ts:157:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.error
    [Cloud Vision OCR] Γ¥î Error: Error: Cloud Vision API Error: Quota exceeded
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\ocr\processImageWithCloudVision.test.ts:295:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 155 |[39m
     [90m 156 |[39m     } [36mcatch[39m (error[33m:[39m unknown) {
    [31m[1m>[22m[39m[90m 157 |[39m       console[33m.[39merror([32m'[Cloud Vision OCR] Γ¥î Error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 158 |[39m
     [90m 159 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 160 |[39m[0m

      at error (src/ocr-cloud-vision.ts:157:15)

  console.log
    [Cloud Vision OCR] Processing image for user: test-user-ocr-123, scan: undefined

      at log (src/ocr-cloud-vision.ts:79:15)

  console.log
    [Cloud Vision OCR] Γ£à Success - Text length: 25, Confidence: 0.00%

      at log (src/ocr-cloud-vision.ts:147:15)

PASS src/__tests__/ocr/processImageWithCloudVision.test.ts (5.12 s)
  ≡ƒô╕ OCR Functions - processImageWithCloudVision
    Γ£à Cen├írios Positivos
      ΓêÜ deve processar imagem e extrair texto com sucesso (18 ms)
      ΓêÜ deve retornar blocks individuais de texto (3 ms)
      ΓêÜ deve processar imagem sem scanId opcional (3 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (57 ms)
      ΓêÜ deve retornar erro se imageData ausente (2 ms)
      ΓêÜ deve retornar erro se userId ausente (1 ms)
      ΓêÜ deve retornar erro se usu├írio tentar processar imagem de outro usu├írio (1 ms)
      ΓêÜ deve retornar success:false se nenhum texto detectado (7 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com falha na API Cloud Vision (22 ms)
      ΓêÜ deve lidar com imagem base64 inv├ílida (11 ms)
      ΓêÜ deve lidar com imagem muito grande (26 ms)
      ΓêÜ deve lidar com detections sem boundingPoly (8 ms)

  console.error
    API Error: {
      error: 'reportType is required',
      stack: 'ApiError: reportType is required\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\reports.routes.ts:156:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\reports.routes.test.ts:25:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/reports/export',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Unknown report type: invalid-report-type',
      stack: 'ApiError: Unknown report type: invalid-report-type\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\reports.routes.ts:167:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\reports.routes.test.ts:25:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/reports/export',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.error
    API Error: {
      error: 'Unknown format: invalid-format',
      stack: 'ApiError: Unknown format: invalid-format\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\reports.routes.ts:178:13\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:149:13)\n' +
        '    at Route.dispatch (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\route.js:119:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:284:15\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at router.handle (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:175:3)\n' +
        '    at router (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:47:12)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at mockAuthMiddleware (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\src\\api\\v1\\__tests__\\reports.routes.test.ts:25:3)\n' +
        '    at Layer.handle [as handle_request] (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\layer.js:95:5)\n' +
        '    at trim_prefix (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:328:13)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:286:9\n' +
        '    at router.process_params (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:346:12)\n' +
        '    at next (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\express\\lib\\router\\index.js:280:10)\n' +
        '    at C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\body-parser\\lib\\read.js:137:5\n' +
        '    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)\n' +
        '    at invokeCallback (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:238:16)\n' +
        '    at done (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:227:7)\n' +
        '    at IncomingMessage.onEnd (C:\\Necxu\\projects\\medicamenta.me\\applications\\medicamenta.me-back-functions\\node_modules\\raw-body\\index.js:287:7)\n' +
        '    at IncomingMessage.emit (node:events:507:28)\n' +
        '    at endReadableNT (node:internal/streams/readable:1701:12)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:90:21)',
      path: '/v1/reports/export',
      method: 'POST',
      requestId: undefined
    }

    [0m [90m 13 |[39m )[33m:[39m [36mvoid[39m {
     [90m 14 |[39m   [90m// Log error[39m
    [31m[1m>[22m[39m[90m 15 |[39m   console[33m.[39merror([32m'API Error:'[39m[33m,[39m {
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 16 |[39m     error[33m:[39m err[33m.[39mmessage[33m,[39m
     [90m 17 |[39m     stack[33m:[39m err[33m.[39mstack[33m,[39m
     [90m 18 |[39m     path[33m:[39m req[33m.[39mpath[33m,[39m[0m

      at error (src/api/middleware/error-handler.ts:15:11)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at Immediate.next (node_modules/express/lib/router/index.js:280:10)
      at Immediate._onImmediate (node_modules/express/lib/router/index.js:646:15)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/v1/__tests__/reports.routes.test.ts
  ≡ƒôê Reports Routes - Integration Tests
    GET /v1/reports/adherence
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar relat├│rio de ader├¬ncia de todos os pacientes (76 ms)
        ΓêÜ deve filtrar por patientId espec├¡fico (52 ms)
        ΓêÜ deve filtrar por per├¡odo de datas (63 ms)
        ΓêÜ deve incluir m├⌐tricas detalhadas por paciente (46 ms)
        ΓêÜ deve calcular taxa m├⌐dia de ader├¬ncia no sum├írio (42 ms)
    GET /v1/reports/compliance
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar relat├│rio de compliance (44 ms)
        ΓêÜ deve incluir m├⌐tricas gerais do parceiro (51 ms)
        ΓêÜ deve incluir m├⌐tricas dos ├║ltimos 30 dias (46 ms)
    POST /v1/reports/export
      Γ£à Cen├írios Positivos
        ΓêÜ deve exportar relat├│rio em formato JSON (17 ms)
        ΓêÜ deve aceitar formato CSV (9 ms)
        ΓêÜ deve usar formato JSON por padr├úo (7 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar 400 se reportType est├í faltando (27 ms)
        ΓêÜ deve retornar 400 se reportType ├⌐ inv├ílido (46 ms)
        ΓêÜ deve retornar 400 se formato ├⌐ inv├ílido (13 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    Γ£à PagSeguro subscription updated: SUB123, status: active

      at log (src/pagseguro-functions.ts:201:13)

  console.log
    Γ£à PagSeguro subscription updated: SUB456, status: active

      at log (src/pagseguro-functions.ts:201:13)

  console.log
    Γ£à PagSeguro subscription updated: SUB789, status: canceled

      at log (src/pagseguro-functions.ts:201:13)

  console.log
    Γ£à PagSeguro subscription updated: SUB111, status: past_due

      at log (src/pagseguro-functions.ts:201:13)

  console.log
    Γ£à Payment successful for subscription: SUB123

      at log (src/pagseguro-functions.ts:240:15)

  console.log
    Γ£à Payment successful for subscription: SUB456

      at log (src/pagseguro-functions.ts:240:15)

  console.log
    Γ£à Payment successful for subscription: SUB789

      at log (src/pagseguro-functions.ts:240:15)

  console.log
    Γ¥î Payment failed for subscription: SUB999

      at log (src/pagseguro-functions.ts:251:15)

  console.error
    Error processing PagSeguro notification: Error: API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\pagseguroNotification.test.ts:398:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 158 |[39m     res[33m.[39mstatus([35m200[39m)[33m.[39msend([32m'OK'[39m)[33m;[39m
     [90m 159 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 160 |[39m     console[33m.[39merror([32m'Error processing PagSeguro notification:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 161 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39msend([32m'Error processing notification'[39m)[33m;[39m
     [90m 162 |[39m   }
     [90m 163 |[39m })[33m;[39m[0m

      at error (src/pagseguro-functions.ts:160:13)

  console.error
    Error handling pre-approval notification: Error: Firestore Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\pagseguroNotification.test.ts:429:36)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 201 |[39m     console[33m.[39mlog([32m`Γ£à PagSeguro subscription updated: ${reference}, status: ${mappedStatus}`[39m)[33m;[39m
     [90m 202 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 203 |[39m     console[33m.[39merror([32m'Error handling pre-approval notification:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 204 |[39m     [36mthrow[39m error[33m;[39m
     [90m 205 |[39m   }
     [90m 206 |[39m }[0m

      at error (src/pagseguro-functions.ts:203:13)
      at src/pagseguro-functions.ts:153:7
      at Object.<anonymous> (src/__tests__/pagseguro/pagseguroNotification.test.ts:431:7)

  console.error
    Error processing PagSeguro notification: Error: Firestore Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\pagseguroNotification.test.ts:429:36)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 158 |[39m     res[33m.[39mstatus([35m200[39m)[33m.[39msend([32m'OK'[39m)[33m;[39m
     [90m 159 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 160 |[39m     console[33m.[39merror([32m'Error processing PagSeguro notification:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 161 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39msend([32m'Error processing notification'[39m)[33m;[39m
     [90m 162 |[39m   }
     [90m 163 |[39m })[33m;[39m[0m

      at error (src/pagseguro-functions.ts:160:13)
      at Object.<anonymous> (src/__tests__/pagseguro/pagseguroNotification.test.ts:431:7)

  console.log
    Γ£à PagSeguro subscription updated: SUB123, status: active

      at log (src/pagseguro-functions.ts:201:13)

  console.error
    Error processing PagSeguro notification: Error: XML parsing error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\pagseguroNotification.test.ts:480:57)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 158 |[39m     res[33m.[39mstatus([35m200[39m)[33m.[39msend([32m'OK'[39m)[33m;[39m
     [90m 159 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 160 |[39m     console[33m.[39merror([32m'Error processing PagSeguro notification:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 161 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39msend([32m'Error processing notification'[39m)[33m;[39m
     [90m 162 |[39m   }
     [90m 163 |[39m })[33m;[39m[0m

      at error (src/pagseguro-functions.ts:160:13)
      at Object.<anonymous> (src/__tests__/pagseguro/pagseguroNotification.test.ts:485:7)

  console.error
    Error processing PagSeguro notification: Error: ETIMEDOUT
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\pagseguroNotification.test.ts:496:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 158 |[39m     res[33m.[39mstatus([35m200[39m)[33m.[39msend([32m'OK'[39m)[33m;[39m
     [90m 159 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 160 |[39m     console[33m.[39merror([32m'Error processing PagSeguro notification:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 161 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39msend([32m'Error processing notification'[39m)[33m;[39m
     [90m 162 |[39m   }
     [90m 163 |[39m })[33m;[39m[0m

      at error (src/pagseguro-functions.ts:160:13)

  console.log
    Γ£à PagSeguro subscription updated: SUB222, status: canceled

      at log (src/pagseguro-functions.ts:201:13)

PASS src/__tests__/pagseguro/pagseguroNotification.test.ts
  pagseguroNotification
    Cen├írios Positivos - PreApproval
      ΓêÜ should successfully process preApproval notification (active status) (10 ms)
      ΓêÜ should update subscription status to active for ACTIVE status (3 ms)
      ΓêÜ should downgrade to free plan when subscription cancelled (3 ms)
      ΓêÜ should map SUSPENDED status to past_due (2 ms)
    Cen├írios Positivos - Transaction
      ΓêÜ should successfully process transaction notification (payment successful) (5 ms)
      ΓêÜ should reset usage counters for successful payment (status 3) (2 ms)
      ΓêÜ should reset usage counters for payment available (status 4) (2 ms)
      ΓêÜ should mark subscription as past_due for canceled payment (status 7) (2 ms)
    Cen├írios Negativos
      ΓêÜ should return 400 if notificationCode is missing
      ΓêÜ should return 400 if notificationType is missing
      ΓêÜ should return 400 for unknown notification type (1 ms)
      ΓêÜ should return 500 if PagSeguro API fails (17 ms)
      ΓêÜ should return 500 if Firestore update fails (10 ms)
    Edge Cases
      ΓêÜ should accept notification from query parameters (2 ms)
      ΓêÜ should handle invalid XML parsing error (5 ms)
      ΓêÜ should handle network timeout (7 ms)
      ΓêÜ should handle EXPIRED preApproval status (2 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error creating checkout session: HttpsError: User must be authenticated
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\stripe-functions.ts:19:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:279:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'unauthenticated',
      details: undefined,
      httpErrorCode: { canonicalName: 'UNAUTHENTICATED', status: 401 }
    }

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:279:20)

  console.error
    Error creating checkout session: HttpsError: Missing required fields
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\stripe-functions.ts:29:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:303:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'invalid-argument',
      details: undefined,
      httpErrorCode: { canonicalName: 'INVALID_ARGUMENT', status: 400 }
    }

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:303:20)

  console.error
    Error creating checkout session: HttpsError: Missing required fields
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\stripe-functions.ts:29:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:327:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'invalid-argument',
      details: undefined,
      httpErrorCode: { canonicalName: 'INVALID_ARGUMENT', status: 400 }
    }

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:327:20)

  console.error
    Error creating checkout session: HttpsError: Missing required fields
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\stripe-functions.ts:29:15
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\common\onInit.js:33:16
        at Function.fixedLen [as run] (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions\lib\v1\providers\https.js:77:47)
        at wrapped (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\firebase-functions-test\lib\v1.js:71:30)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:351:20)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      code: 'invalid-argument',
      details: undefined,
      httpErrorCode: { canonicalName: 'INVALID_ARGUMENT', status: 400 }
    }

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at node_modules/firebase-functions/lib/common/onInit.js:33:16
      at Function.fixedLen [as run] (node_modules/firebase-functions/lib/v1/providers/https.js:77:47)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:351:20)

  console.error
    Error creating checkout session: Error: Stripe API Error: Invalid request
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:358:50)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:379:7)

  console.error
    Error creating checkout session: Error: Stripe API Error: Invalid price ID
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCheckoutSession.test.ts:392:9)

    [0m [90m 87 |[39m       }[33m;[39m
     [90m 88 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 89 |[39m       console[33m.[39merror([32m'Error creating checkout session:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 90 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 91 |[39m     }
     [90m 92 |[39m   }[0m

      at error (src/stripe-functions.ts:89:15)
      at Object.<anonymous> (src/__tests__/stripe/createStripeCheckoutSession.test.ts:414:7)

PASS src/__tests__/stripe/createStripeCheckoutSession.test.ts
  ≡ƒö╡ Stripe Functions - createStripeCheckoutSession
    Γ£à Cen├írios Positivos
      ΓêÜ deve criar sess├úo de checkout com dados v├ílidos (349 ms)
      ΓêÜ deve reutilizar customer existente (27 ms)
      ΓêÜ deve incluir metadata correto na sess├úo (9 ms)
      ΓêÜ deve salvar customerId no Firestore ap├│s cria├º├úo (30 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se usu├írio n├úo autenticado (13 ms)
      ΓêÜ deve retornar erro se priceId ausente (8 ms)
      ΓêÜ deve retornar erro se userId ausente (7 ms)
      ΓêÜ deve retornar erro se plan ausente (6 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com falha na cria├º├úo do customer Stripe (25 ms)
      ΓêÜ deve lidar com falha na cria├º├úo da sess├úo de checkout (19 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error creating customer portal: {
      type: 'StripeInvalidRequestError',
      message: 'No such customer: cus_invalid'
    }

    [0m [90m 445 |[39m       [36mreturn[39m { url[33m:[39m session[33m.[39murl }[33m;[39m
     [90m 446 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 447 |[39m       console[33m.[39merror([32m'Error creating customer portal:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 448 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 449 |[39m     }
     [90m 450 |[39m   }[0m

      at error (src/stripe-functions.ts:447:15)

  console.error
    Error creating customer portal: Error: Stripe API Error: Service temporarily unavailable
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\createStripeCustomerPortal.test.ts:208:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 445 |[39m       [36mreturn[39m { url[33m:[39m session[33m.[39murl }[33m;[39m
     [90m 446 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 447 |[39m       console[33m.[39merror([32m'Error creating customer portal:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 448 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 449 |[39m     }
     [90m 450 |[39m   }[0m

      at error (src/stripe-functions.ts:447:15)

PASS src/__tests__/stripe/createStripeCustomerPortal.test.ts
  ≡ƒö╡ Stripe Functions - createStripeCustomerPortal
    Γ£à Cen├írios Positivos
      ΓêÜ deve criar sess├úo do customer portal (1 ms)
      ΓêÜ deve criar sess├úo com returnUrl padr├úo (4 ms)
      ΓêÜ deve retornar URL v├ílida do portal
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (23 ms)
      ΓêÜ deve retornar erro se customerId ausente (1 ms)
      ΓêÜ deve retornar erro se customer n├úo encontrado (6 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com erro da API Stripe (6 ms)
      ΓêÜ deve lidar com returnUrl com caracteres especiais (1 ms)
      ΓêÜ deve lidar com customer sem subscription ativa (1 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error suspending PagSeguro subscription: Error: API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\suspendPagSeguroSubscription.test.ts:125:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 376 |[39m     } [36mcatch[39m (error) {
     [90m 377 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 378 |[39m       console[33m.[39merror([32m'Error suspending PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 379 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 380 |[39m     }
     [90m 381 |[39m   }[0m

      at error (src/pagseguro-functions.ts:378:15)

  console.error
    Error suspending PagSeguro subscription: Error: Not found
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\suspendPagSeguroSubscription.test.ts:139:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 404 }
    }

    [0m [90m 376 |[39m     } [36mcatch[39m (error) {
     [90m 377 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 378 |[39m       console[33m.[39merror([32m'Error suspending PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 379 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 380 |[39m     }
     [90m 381 |[39m   }[0m

      at error (src/pagseguro-functions.ts:378:15)

  console.error
    Error suspending PagSeguro subscription: Error: Subscription already suspended
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\suspendPagSeguroSubscription.test.ts:149:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 400 }
    }

    [0m [90m 376 |[39m     } [36mcatch[39m (error) {
     [90m 377 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 378 |[39m       console[33m.[39merror([32m'Error suspending PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 379 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 380 |[39m     }
     [90m 381 |[39m   }[0m

      at error (src/pagseguro-functions.ts:378:15)

  console.error
    Error suspending PagSeguro subscription: Error: ETIMEDOUT
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\suspendPagSeguroSubscription.test.ts:159:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 376 |[39m     } [36mcatch[39m (error) {
     [90m 377 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 378 |[39m       console[33m.[39merror([32m'Error suspending PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 379 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 380 |[39m     }
     [90m 381 |[39m   }[0m

      at error (src/pagseguro-functions.ts:378:15)

  console.error
    Error suspending PagSeguro subscription: Error: Unauthorized
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\suspendPagSeguroSubscription.test.ts:167:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 401 }
    }

    [0m [90m 376 |[39m     } [36mcatch[39m (error) {
     [90m 377 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 378 |[39m       console[33m.[39merror([32m'Error suspending PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 379 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 380 |[39m     }
     [90m 381 |[39m   }[0m

      at error (src/pagseguro-functions.ts:378:15)

PASS src/__tests__/pagseguro/suspendPagSeguroSubscription.test.ts
  suspendPagSeguroSubscription
    Cen├írios Positivos
      ΓêÜ should successfully suspend subscription (2 ms)
      ΓêÜ should call correct PagSeguro API endpoint with credentials (1 ms)
      ΓêÜ should return success message (1 ms)
    Cen├írios Negativos
      ΓêÜ should throw error if user not authenticated (33 ms)
      ΓêÜ should throw error if subscriptionCode is missing (2 ms)
      ΓêÜ should throw error if subscriptionCode is empty (3 ms)
      ΓêÜ should throw error if PagSeguro API fails (8 ms)
    Edge Cases
      ΓêÜ should handle subscription not found (404) (4 ms)
      ΓêÜ should handle already suspended subscription (400) (7 ms)
      ΓêÜ should handle network timeout (4 ms)
      ΓêÜ should handle unauthorized (401) (4 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error canceling PagSeguro subscription: Error: PagSeguro API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\cancelPagSeguroSubscription.test.ts:139:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 344 |[39m     } [36mcatch[39m (error) {
     [90m 345 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m       console[33m.[39merror([32m'Error canceling PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 347 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 348 |[39m     }
     [90m 349 |[39m   }[0m

      at error (src/pagseguro-functions.ts:346:15)

  console.error
    Error canceling PagSeguro subscription: {
      response: { status: 404, data: { error: 'Subscription not found' } }
    }

    [0m [90m 344 |[39m     } [36mcatch[39m (error) {
     [90m 345 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m       console[33m.[39merror([32m'Error canceling PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 347 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 348 |[39m     }
     [90m 349 |[39m   }[0m

      at error (src/pagseguro-functions.ts:346:15)

  console.error
    Error canceling PagSeguro subscription: {
      response: { status: 400, data: { error: 'Subscription already canceled' } }
    }

    [0m [90m 344 |[39m     } [36mcatch[39m (error) {
     [90m 345 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m       console[33m.[39merror([32m'Error canceling PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 347 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 348 |[39m     }
     [90m 349 |[39m   }[0m

      at error (src/pagseguro-functions.ts:346:15)

  console.error
    Error canceling PagSeguro subscription: Error: ETIMEDOUT
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\cancelPagSeguroSubscription.test.ts:184:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 344 |[39m     } [36mcatch[39m (error) {
     [90m 345 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m       console[33m.[39merror([32m'Error canceling PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 347 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 348 |[39m     }
     [90m 349 |[39m   }[0m

      at error (src/pagseguro-functions.ts:346:15)

  console.error
    Error canceling PagSeguro subscription: { response: { status: 401, data: { error: 'Unauthorized' } } }

    [0m [90m 344 |[39m     } [36mcatch[39m (error) {
     [90m 345 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 346 |[39m       console[33m.[39merror([32m'Error canceling PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 347 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 348 |[39m     }
     [90m 349 |[39m   }[0m

      at error (src/pagseguro-functions.ts:346:15)

PASS src/__tests__/pagseguro/cancelPagSeguroSubscription.test.ts
  ≡ƒƒú PagSeguro Functions - cancelPagSeguroSubscription
    Γ£à Cen├írios Positivos
      ΓêÜ deve cancelar assinatura com sucesso (2 ms)
      ΓêÜ deve incluir credenciais corretas na URL
      ΓêÜ deve retornar mensagem de sucesso
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (26 ms)
      ΓêÜ deve retornar erro se subscriptionCode ausente (1 ms)
      ΓêÜ deve retornar erro se subscriptionCode vazio (1 ms)
      ΓêÜ deve retornar erro se API PagSeguro falhar (5 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com subscription n├úo encontrada (4 ms)
      ΓêÜ deve lidar com subscription j├í cancelada (6 ms)
      ΓêÜ deve lidar com timeout da API PagSeguro (4 ms)
      ΓêÜ deve lidar com credenciais inv├ílidas (3 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/middleware/__tests__/logger.test.ts
  ≡ƒô¥ Request Logger Middleware
    Γ£à Cen├írios Positivos
      ΓêÜ deve gerar request ID ├║nico (2 ms)
      ΓêÜ deve chamar next() imediatamente
      ΓêÜ deve logar quando response finaliza (26 ms)
      ΓêÜ deve calcular dura├º├úo da request (72 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve usar IP do socket se x-forwarded-for n├úo existe (1 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com query params vazios (1 ms)
      ΓêÜ deve incluir partnerId se dispon├¡vel (14 ms)
      ΓêÜ deve incluir apiKeyId se dispon├¡vel (17 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/__tests__/index.test.ts
  ≡ƒöº Index Helper Functions
    getPriceId() - Mapeamento de Planos
      ΓêÜ deve retornar price ID correto para Premium Monthly (1 ms)
      ΓêÜ deve retornar price ID correto para Premium Yearly
      ΓêÜ deve retornar price ID correto para Family Monthly (1 ms)
      ΓêÜ deve retornar price ID correto para Family Yearly (1 ms)
      ΓêÜ deve lan├ºar erro para plano inv├ílido (16 ms)
    getOrCreateCustomer() - Gest├úo de Clientes Stripe
      Γ£à Cen├írios Positivos
        ΓêÜ deve retornar customer existente se j├í cadastrado (1 ms)
        ΓêÜ deve criar novo customer se n├úo existe (3 ms)
        ΓêÜ deve criar customer com name vazio se n├úo fornecido
        ΓêÜ deve salvar metadata com firebaseUid
      Γ¥î Cen├írios Negativos
        ΓêÜ deve propagar erro se Firestore falhar ao ler (2 ms)
        ΓêÜ deve propagar erro se Stripe API falhar (1 ms)
        ΓêÜ deve propagar erro se Firestore falhar ao escrever (1 ms)
      ΓÜá∩╕Å Edge Cases
        ΓêÜ deve lidar com email vazio
        ΓêÜ deve lidar com customer.data() retornando null (1 ms)
        ΓêÜ deve lidar com userId com caracteres especiais (1 ms)
        ΓêÜ deve lidar com created timestamp muito alto
    ≡ƒöä Integration Scenarios
      ΓêÜ deve testar fluxo completo: customer n├úo existe ΓåÆ criar ΓåÆ retornar ID (1 ms)
      ΓêÜ deve testar fluxo completo: customer existe ΓåÆ retornar ID existente

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error getting PagSeguro transaction history: Error: API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroTransactionHistory.test.ts:212:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 464 |[39m     } [36mcatch[39m (error) {
     [90m 465 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       console[33m.[39merror([32m'Error getting PagSeguro transaction history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 467 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 468 |[39m     }
     [90m 469 |[39m   }[0m

      at error (src/pagseguro-functions.ts:466:15)

  console.error
    Error getting PagSeguro transaction history: Error: XML parsing error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroTransactionHistory.test.ts:255:57)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 464 |[39m     } [36mcatch[39m (error) {
     [90m 465 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       console[33m.[39merror([32m'Error getting PagSeguro transaction history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 467 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 468 |[39m     }
     [90m 469 |[39m   }[0m

      at error (src/pagseguro-functions.ts:466:15)
      at Object.<anonymous> (src/__tests__/pagseguro/getPagSeguroTransactionHistory.test.ts:260:7)

  console.error
    Error getting PagSeguro transaction history: Error: ETIMEDOUT
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroTransactionHistory.test.ts:266:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 464 |[39m     } [36mcatch[39m (error) {
     [90m 465 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       console[33m.[39merror([32m'Error getting PagSeguro transaction history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 467 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 468 |[39m     }
     [90m 469 |[39m   }[0m

      at error (src/pagseguro-functions.ts:466:15)

  console.error
    Error getting PagSeguro transaction history: Error: Unauthorized
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroTransactionHistory.test.ts:274:21)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12) {
      response: { status: 401 }
    }

    [0m [90m 464 |[39m     } [36mcatch[39m (error) {
     [90m 465 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 466 |[39m       console[33m.[39merror([32m'Error getting PagSeguro transaction history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 467 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 468 |[39m     }
     [90m 469 |[39m   }[0m

      at error (src/pagseguro-functions.ts:466:15)

PASS src/__tests__/pagseguro/getPagSeguroTransactionHistory.test.ts
  getPagSeguroTransactionHistory
    Cen├írios Positivos
      ΓêÜ should successfully fetch transaction history (4 ms)
      ΓêÜ should return all required transaction fields (3 ms)
      ΓêÜ should use default days parameter (30) when not provided (2 ms)
    Cen├írios Negativos
      ΓêÜ should throw error if user not authenticated (47 ms)
      ΓêÜ should throw error if email is missing (2 ms)
      ΓêÜ should throw error if PagSeguro API fails (7 ms)
    Edge Cases
      ΓêÜ should handle empty transaction history (2 ms)
      ΓêÜ should handle invalid XML parsing error (10 ms)
      ΓêÜ should handle network timeout (6 ms)
      ΓêÜ should handle unauthorized (401) (7 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (45%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.log
    [Auto Cloud Vision] Γ£à Processed successfully - Confidence: 95%

      at log (src/ocr-cloud-vision.ts:248:17)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (65%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.log
    [Auto Cloud Vision] Γ£à Processed successfully - Confidence: 95%

      at log (src/ocr-cloud-vision.ts:248:17)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (50%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.warn
    [Auto Cloud Vision] No image data URL found in scan document

    [0m [90m 202 |[39m         
     [90m 203 |[39m         [36mif[39m ([33m![39mimageDataUrl) {
    [31m[1m>[22m[39m[90m 204 |[39m           console[33m.[39mwarn([32m'[Auto Cloud Vision] No image data URL found in scan document'[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 205 |[39m           [36mreturn[39m[33m;[39m
     [90m 206 |[39m         }
     [90m 207 |[39m[0m

      at warn (src/ocr-cloud-vision.ts:204:19)
      at cloudFunction.run (node_modules/firebase-functions/lib/common/onInit.js:33:16)
      at wrapped (node_modules/firebase-functions-test/lib/v1.js:71:30)
      at Object.<anonymous> (src/__tests__/ocr/autoProcessLowConfidenceScans.test.ts:274:13)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (50%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.log
    [Auto Cloud Vision] No text detected

      at log (src/ocr-cloud-vision.ts:220:19)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (50%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.error
    [Auto Cloud Vision] Γ¥î Error: Error: Cloud Vision API Error: Service unavailable
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\ocr\autoProcessLowConfidenceScans.test.ts:328:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 249 |[39m
     [90m 250 |[39m       } [36mcatch[39m (error[33m:[39m unknown) {
    [31m[1m>[22m[39m[90m 251 |[39m         console[33m.[39merror([32m'[Auto Cloud Vision] Γ¥î Error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 252 |[39m         
     [90m 253 |[39m         [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
     [90m 254 |[39m         [0m

      at error (src/ocr-cloud-vision.ts:251:17)

  console.log
    [Auto Cloud Vision] Low confidence scan detected (0%) for user: test-user-trigger-123, scan: scan-trigger-456

      at log (src/ocr-cloud-vision.ts:197:15)

  console.log
    [Auto Cloud Vision] Γ£à Processed successfully - Confidence: 95%

      at log (src/ocr-cloud-vision.ts:248:17)

PASS src/__tests__/ocr/autoProcessLowConfidenceScans.test.ts
  ≡ƒöä OCR Triggers - autoProcessLowConfidenceScans
    Γ£à Cen├írios Positivos
      ΓêÜ deve processar automaticamente scan com confian├ºa < 70% (27 ms)
      ΓêÜ deve manter engine=tesseract se confian├ºa original for maior (5 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ N├âO deve processar se confian├ºa >= 70% (1 ms)
      ΓêÜ N├âO deve processar se engine j├í for cloud_vision (1 ms)
      ΓêÜ N├âO deve processar se cloudVisionText j├í existir (1 ms)
      ΓêÜ deve salvar erro se imageDataUrl ausente (10 ms)
      ΓêÜ deve salvar erro se nenhum texto detectado pelo Cloud Vision (4 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com erro da API Cloud Vision (23 ms)
      ΓêÜ deve processar scan com confidence=0 (5 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error canceling subscription: Error: Stripe API Error: Invalid subscription
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\cancelReactivate.test.ts:115:11)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 389 |[39m     [36mreturn[39m { success[33m:[39m [36mtrue[39m[33m,[39m message[33m:[39m [32m'Subscription will be canceled at period end'[39m }[33m;[39m
     [90m 390 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 391 |[39m     console[33m.[39merror([32m'Error canceling subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 392 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 393 |[39m   }
     [90m 394 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:391:13)

  console.error
    Error reactivating subscription: Error: Stripe API Error: Subscription already active
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\cancelReactivate.test.ts:192:11)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 416 |[39m       [36mreturn[39m { success[33m:[39m [36mtrue[39m[33m,[39m message[33m:[39m [32m'Subscription reactivated'[39m }[33m;[39m
     [90m 417 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 418 |[39m       console[33m.[39merror([32m'Error reactivating subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 419 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 420 |[39m     }
     [90m 421 |[39m   }[0m

      at error (src/stripe-functions.ts:418:15)

PASS src/__tests__/stripe/cancelReactivate.test.ts
  ≡ƒö╡ Stripe Functions - Cancel/Reactivate
    cancelStripeSubscription
      Γ£à Cen├írios Positivos
        ΓêÜ deve cancelar subscription com cancel_at_period_end (4 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar erro se n├úo autenticado (21 ms)
        ΓêÜ deve retornar erro se subscriptionId ausente (8 ms)
        ΓêÜ deve retornar erro se Stripe API falhar (7 ms)
    reactivateStripeSubscription
      Γ£à Cen├írios Positivos
        ΓêÜ deve reativar subscription removendo cancel_at_period_end (1 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar erro se n├úo autenticado (1 ms)
        ΓêÜ deve retornar erro se subscriptionId ausente (1 ms)
        ΓêÜ deve retornar erro se Stripe API falhar (4 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error getting subscription status: {
      type: 'StripeInvalidRequestError',
      message: 'No such subscription: sub_invalid'
    }

    [0m [90m 361 |[39m       }[33m;[39m
     [90m 362 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 363 |[39m       console[33m.[39merror([32m'Error getting subscription status:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 364 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 365 |[39m     }
     [90m 366 |[39m   }[0m

      at error (src/stripe-functions.ts:363:15)

  console.error
    Error getting subscription status: Error: Stripe API Error: Service unavailable
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\getStripeSubscriptionStatus.test.ts:268:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 361 |[39m       }[33m;[39m
     [90m 362 |[39m     } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 363 |[39m       console[33m.[39merror([32m'Error getting subscription status:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 364 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 365 |[39m     }
     [90m 366 |[39m   }[0m

      at error (src/stripe-functions.ts:363:15)

PASS src/__tests__/stripe/getStripeSubscriptionStatus.test.ts
  ≡ƒö╡ Stripe Functions - getStripeSubscriptionStatus
    Γ£à Cen├írios Positivos
      ΓêÜ deve retornar status de subscription ativa (2 ms)
      ΓêÜ deve retornar status trialing (1 ms)
      ΓêÜ deve retornar subscription marcada para cancelamento (1 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (24 ms)
      ΓêÜ deve retornar erro se subscriptionId ausente (1 ms)
      ΓêÜ deve retornar erro se subscription n├úo encontrada (4 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com subscription cancelada
      ΓêÜ deve lidar com subscription past_due (1 ms)
      ΓêÜ deve lidar com erro da API Stripe (4 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error getting PagSeguro subscription status: Error: PagSeguro API Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroSubscriptionStatus.test.ts:142:41)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 312 |[39m     } [36mcatch[39m (error) {
     [90m 313 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 314 |[39m       console[33m.[39merror([32m'Error getting PagSeguro subscription status:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 315 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 316 |[39m     }
     [90m 317 |[39m   }[0m

      at error (src/pagseguro-functions.ts:314:15)

  console.error
    Error getting PagSeguro subscription status: { response: { status: 404 } }

    [0m [90m 312 |[39m     } [36mcatch[39m (error) {
     [90m 313 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 314 |[39m       console[33m.[39merror([32m'Error getting PagSeguro subscription status:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 315 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 316 |[39m     }
     [90m 317 |[39m   }[0m

      at error (src/pagseguro-functions.ts:314:15)

  console.error
    Error getting PagSeguro subscription status: Error: XML Parse Error
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\getPagSeguroSubscriptionStatus.test.ts:168:57)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 312 |[39m     } [36mcatch[39m (error) {
     [90m 313 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 314 |[39m       console[33m.[39merror([32m'Error getting PagSeguro subscription status:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 315 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 316 |[39m     }
     [90m 317 |[39m   }[0m

      at error (src/pagseguro-functions.ts:314:15)
      at Object.<anonymous> (src/__tests__/pagseguro/getPagSeguroSubscriptionStatus.test.ts:173:7)

PASS src/__tests__/pagseguro/getPagSeguroSubscriptionStatus.test.ts
  ≡ƒƒú PagSeguro Functions - getPagSeguroSubscriptionStatus
    Γ£à Cen├írios Positivos
      ΓêÜ deve buscar status da assinatura com sucesso (2 ms)
      ΓêÜ deve retornar todos os campos obrigat├│rios (2 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (23 ms)
      ΓêÜ deve retornar erro se subscriptionCode ausente (1 ms)
      ΓêÜ deve retornar erro se API PagSeguro falhar (8 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com subscription n├úo encontrada (6 ms)
      ΓêÜ deve lidar com XML inv├ílido (6 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error getting payment history: {
      type: 'StripeInvalidRequestError',
      message: 'No such customer: cus_invalid'
    }

    [0m [90m 513 |[39m     }[33m;[39m
     [90m 514 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 515 |[39m     console[33m.[39merror([32m'Error getting payment history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 516 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 517 |[39m   }
     [90m 518 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:515:13)

  console.error
    Error getting payment history: Error: Stripe API Error: Rate limit exceeded
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\getStripePaymentHistory.test.ts:392:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 513 |[39m     }[33m;[39m
     [90m 514 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 515 |[39m     console[33m.[39merror([32m'Error getting payment history:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 516 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 517 |[39m   }
     [90m 518 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:515:13)

PASS src/__tests__/stripe/getStripePaymentHistory.test.ts
  ≡ƒö╡ Stripe Functions - getStripePaymentHistory
    Γ£à Cen├írios Positivos
      ΓêÜ deve listar faturas do cliente com limit padr├úo (2 ms)
      ΓêÜ deve listar faturas com limit customizado (1 ms)
      ΓêÜ deve converter valores de centavos para reais corretamente
      ΓêÜ deve incluir todas as informa├º├╡es da fatura
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (25 ms)
      ΓêÜ deve retornar erro se customerId ausente (1 ms)
      ΓêÜ deve retornar erro se customer n├úo encontrado (4 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve retornar array vazio se cliente sem faturas (1 ms)
      ΓêÜ deve lidar com faturas de diferentes status
      ΓêÜ deve lidar com faturas sem PDF
      ΓêÜ deve lidar com erro da API Stripe (5 ms)
      ΓêÜ deve lidar com limit muito grande

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/middleware/__tests__/api-key-validator.test.ts
  ≡ƒöæ API Key Validator
    validateApiKey()
      Γ£à Cen├írios Positivos
        ΓêÜ deve validar API key v├ílida (4 ms)
        ΓêÜ deve usar cache para API key j├í consultada (1 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar erro 401 se X-API-Key header n├úo existe (1 ms)
        ΓêÜ deve retornar erro 401 se API key n├úo existe (1 ms)
        ΓêÜ deve retornar erro 403 se API key est├í suspensa (1 ms)
        ΓêÜ deve retornar erro 403 se API key est├í revogada (1 ms)
        ΓêÜ deve retornar erro 401 se API key expirou (1 ms)
      ΓÜá∩╕Å Edge Cases
        ΓêÜ deve lidar com Firestore erro (1 ms)
        ΓêÜ deve atualizar usage stats assincronamente (1 ms)
    generateApiKey()
      ΓêÜ deve gerar API key com tier free (1 ms)
      ΓêÜ deve gerar API key com tier enterprise (1 ms)
      ΓêÜ deve criar audit log ao gerar key (1 ms)
    revokeApiKey()
      ΓêÜ deve revogar API key (1 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/utils/__tests__/api-error.test.ts
  ApiError
    Γ£à Construtor
      ΓêÜ deve criar erro com todos os par├ómetros (2 ms)
      ΓêÜ deve criar erro sem details (1 ms)
      ΓêÜ deve manter stack trace adequado (14 ms)
    Γ£à toJSON
      ΓêÜ deve serializar erro completo com details (1 ms)
      ΓêÜ deve serializar erro sem details
      ΓêÜ deve ter timestamp v├ílido no formato ISO (1 ms)
    Γ£à Heran├ºa de Error
      ΓêÜ deve ser capturado em try-catch como Error (2 ms)
      ΓêÜ deve ser capturado em try-catch como ApiError (1 ms)
      ΓêÜ deve preservar mensagem em throw (1 ms)
  ApiErrors Helpers
    Γ£à UNAUTHORIZED
      ΓêÜ deve criar erro 401 com mensagem padr├úo (3 ms)
      ΓêÜ deve criar erro 401 com mensagem customizada
    Γ£à FORBIDDEN
      ΓêÜ deve criar erro 403 com mensagem padr├úo (1 ms)
      ΓêÜ deve criar erro 403 com mensagem customizada (1 ms)
    Γ£à NOT_FOUND
      ΓêÜ deve criar erro 404 para usu├írio (1 ms)
      ΓêÜ deve criar erro 404 para produto (1 ms)
      ΓêÜ deve criar erro 404 para qualquer recurso (1 ms)
    Γ£à VALIDATION_ERROR
      ΓêÜ deve criar erro 400 com detalhes de valida├º├úo (1 ms)
      ΓêÜ deve criar erro 400 com array de erros
      ΓêÜ deve criar erro 400 com details vazio
    Γ£à RATE_LIMIT_EXCEEDED
      ΓêÜ deve criar erro 429 com retryAfter (2 ms)
      ΓêÜ deve criar erro 429 com retryAfter = 0
      ΓêÜ deve criar erro 429 com retryAfter alto
    Γ£à INTERNAL_ERROR
      ΓêÜ deve criar erro 500 com mensagem padr├úo (1 ms)
      ΓêÜ deve criar erro 500 com mensagem customizada
    Γ£à SERVICE_UNAVAILABLE
      ΓêÜ deve criar erro 503 com mensagem padr├úo
      ΓêÜ deve criar erro 503 com mensagem customizada
    Γ£à Integra├º├úo: Serializa├º├úo de Helpers
      ΓêÜ deve serializar UNAUTHORIZED corretamente (1 ms)
      ΓêÜ deve serializar VALIDATION_ERROR com details (1 ms)
      ΓêÜ deve serializar RATE_LIMIT_EXCEEDED com retryAfter
    Γ¥î Edge Cases
      ΓêÜ deve lidar com statusCode negativo
      ΓêÜ deve lidar com code vazio
      ΓêÜ deve lidar com message vazio (1 ms)
      ΓêÜ deve lidar com details null
      ΓêÜ deve lidar com details undefined expl├¡cito
      ΓêÜ deve lidar com details complexo (objeto aninhado) (1 ms)
      ΓêÜ deve lidar com resource NOT_FOUND vazio
      ΓêÜ deve lidar com VALIDATION_ERROR com null
      ΓêÜ deve lidar com RATE_LIMIT_EXCEEDED com n├║mero negativo

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/middleware/__tests__/auth.test.ts
  ≡ƒöÉ Auth Middleware
    authenticate()
      Γ£à Cen├írios Positivos
        ΓêÜ deve autenticar com Firebase ID token v├ílido (3 ms)
        ΓêÜ deve autenticar com JWT token v├ílido quando Firebase falha (1 ms)
      Γ¥î Cen├írios Negativos
        ΓêÜ deve retornar erro 401 se authorization header n├úo existe (1 ms)
        ΓêÜ deve retornar erro 401 se scheme n├úo ├⌐ Bearer
        ΓêÜ deve retornar erro 401 se token est├í vazio (1 ms)
        ΓêÜ deve retornar erro 401 se Firebase e JWT tokens s├úo inv├ílidos (1 ms)
      ΓÜá∩╕Å Edge Cases
        ΓêÜ deve lidar com token Firebase sem permissions (1 ms)
        ΓêÜ deve lidar com token JWT sem email (2 ms)
    generateAccessToken()
      ΓêÜ deve gerar token com payload completo (1 ms)
      ΓêÜ deve gerar token com payload m├¡nimo (8 ms)
    generateRefreshToken()
      ΓêÜ deve gerar refresh token com sub (1 ms)
    verifyRefreshToken()
      ΓêÜ deve verificar token v├ílido (1 ms)
      ΓêÜ deve lan├ºar erro para token inv├ílido (47 ms)
    requirePermissions()
      ΓêÜ deve permitir acesso com permiss├úo correta (1 ms)
      ΓêÜ deve permitir acesso com m├║ltiplas permiss├╡es
      ΓêÜ deve permitir acesso com permiss├úo admin (1 ms)
      ΓêÜ deve retornar 401 se usu├írio n├úo est├í autenticado
      ΓêÜ deve retornar 403 se permiss├úo faltando (1 ms)
      ΓêÜ deve lidar com usu├írio sem array de permissions

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error updating subscription: Error: Stripe API Error: No such subscription
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\updateStripeSubscription.test.ts:217:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 554 |[39m     }[33m;[39m
     [90m 555 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 556 |[39m     console[33m.[39merror([32m'Error updating subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 557 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 558 |[39m   }
     [90m 559 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:556:13)

  console.error
    Error updating subscription: Error: Stripe API Error: No such price
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\updateStripeSubscription.test.ts:246:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 554 |[39m     }[33m;[39m
     [90m 555 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 556 |[39m     console[33m.[39merror([32m'Error updating subscription:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 557 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 558 |[39m   }
     [90m 559 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:556:13)
      at Object.<anonymous> (src/__tests__/stripe/updateStripeSubscription.test.ts:249:7)

PASS src/__tests__/stripe/updateStripeSubscription.test.ts
  ≡ƒö╡ Stripe Functions - updateStripeSubscription
    Γ£à Cen├írios Positivos
      ΓêÜ deve fazer upgrade de plano (Basic ΓåÆ Premium) (2 ms)
      ΓêÜ deve fazer downgrade de plano (Premium ΓåÆ Basic) (1 ms)
      ΓêÜ deve aplicar proration_behavior corretamente
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (26 ms)
      ΓêÜ deve retornar erro se subscriptionId ausente (2 ms)
      ΓêÜ deve retornar erro se newPriceId ausente (1 ms)
      ΓêÜ deve retornar erro se ambos os campos ausentes (1 ms)
      ΓêÜ deve retornar erro se subscription n├úo existe (5 ms)
      ΓêÜ deve retornar erro se priceId inv├ílido (6 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com subscription com m├║ltiplos items (usar primeiro)
      ΓêÜ deve lidar com subscription j├í usando o mesmo priceId (1 ms)
      ΓêÜ deve lidar com subscription cancelada (status=canceled) (1 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

PASS src/api/middleware/__tests__/rate-limiter.test.ts
  ΓÅ▒∩╕Å Rate Limiter Middleware
    Γ£à Cen├írios Positivos
      ΓêÜ deve permitir request dentro do limite (tier free) (3 ms)
      ΓêÜ deve usar tier correto quando fornecido (5 ms)
      ΓêÜ deve identificar cliente por API key
      ΓêÜ deve identificar cliente por user ID (3 ms)
      ΓêÜ deve resetar contador ap├│s janela de tempo (1 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve bloquear quando limite ├⌐ excedido (tier free) (3 ms)
      ΓêÜ deve incluir Retry-After header quando bloqueado (12 ms)
      ΓêÜ deve incluir X-RateLimit-Reset header (1 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve usar tier free como fallback para tier desconhecido (1 ms)
      ΓêÜ deve usar IP como fallback se n├úo h├í API key nem user
      ΓêÜ deve decrementar remaining corretamente
      ΓêÜ deve lidar com diferentes tiers corretamente (2 ms)
      ΓêÜ deve capturar exce├º├╡es e passar para next
      ΓêÜ deve incluir details no erro de rate limit (2 ms)

  console.log
    Γ£à Jest Setup: Firebase Admin inicializado com emulators

      at Object.<anonymous> (src/__tests__/setup.ts:40:9)

  console.log
       - Firestore Emulator: localhost:8080

      at Object.<anonymous> (src/__tests__/setup.ts:41:9)

  console.log
       - Project ID: test-project

      at Object.<anonymous> (src/__tests__/setup.ts:42:9)

  console.error
    Error getting upcoming invoice: Error: Stripe API Error: Invalid customer
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\getStripeUpcomingInvoice.test.ts:132:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 477 |[39m     }[33m;[39m
     [90m 478 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 479 |[39m     console[33m.[39merror([32m'Error getting upcoming invoice:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 480 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 481 |[39m   }
     [90m 482 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:479:13)

  console.error
    Error getting upcoming invoice: Error: No upcoming invoices for customer
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\stripe\getStripeUpcomingInvoice.test.ts:144:9)
        at Promise.finally.completed (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at _runTestsForDescribeBlock (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:275:16)
        at runTest (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:343:7)
        at Object.worker (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\jest-runner\build\testWorker.js:497:12)

    [0m [90m 477 |[39m     }[33m;[39m
     [90m 478 |[39m   } [36mcatch[39m (error[33m:[39m any) {
    [31m[1m>[22m[39m[90m 479 |[39m     console[33m.[39merror([32m'Error getting upcoming invoice:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 480 |[39m     [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m error[33m?[39m[33m.[39mmessage [33m||[39m [32m'Unknown error'[39m)[33m;[39m
     [90m 481 |[39m   }
     [90m 482 |[39m })[33m;[39m[0m

      at error (src/stripe-functions.ts:479:13)

PASS src/__tests__/stripe/getStripeUpcomingInvoice.test.ts
  ≡ƒö╡ Stripe Functions - getStripeUpcomingInvoice
    Γ£à Cen├írios Positivos
      ΓêÜ deve buscar pr├│xima invoice com sucesso (7 ms)
      ΓêÜ deve converter amount_due de centavos para reais corretamente (5 ms)
      ΓêÜ deve retornar todos os campos obrigat├│rios (1 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (81 ms)
      ΓêÜ deve retornar erro se customerId ausente (1 ms)
      ΓêÜ deve retornar erro se customerId vazio (1 ms)
      ΓêÜ deve retornar erro se Stripe API falhar (15 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com customer sem subscription ativa (5 ms)
      ΓêÜ deve lidar com invoice com amount_due zero (1 ms)
      ΓêÜ deve lidar com valores monet├írios grandes
      ΓêÜ deve lidar com per├¡odo de billing muito curto (trial) (1 ms)

PASS src/api/middleware/__tests__/error-handler.test.ts
  ≡ƒÜ¿ Error Handler Middleware
    Γ£à Cen├írios Positivos
      ΓêÜ deve tratar ApiError corretamente (22 ms)
      ΓêÜ deve logar erro com detalhes (2 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve tratar ValidationError com status 400 (1 ms)
      ΓêÜ deve tratar erro desconhecido com status 500 (2 ms)
      ΓêÜ deve ocultar mensagem de erro em produ├º├úo (1 ms)
      ΓêÜ deve mostrar mensagem de erro em desenvolvimento (2 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com ApiError sem details (2 ms)
      ΓêÜ deve lidar com request sem x-request-id (12 ms)
      ΓêÜ deve incluir timestamp em todas as respostas (2 ms)

  console.error
    Error creating PagSeguro subscription: TypeError: Cannot read properties of undefined (reading 'code')
        at code (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\pagseguro-functions.ts:67:46)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\createPagSeguroSubscription.test.ts:285:7)

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:285:7)

  console.error
    Error creating PagSeguro subscription: Error: Non-whitespace before first tag.
    Line: 0
    Column: 1
    Char: I
        at error (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\sax\lib\sax.js:695:10)
        at strictFail (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\sax\lib\sax.js:724:7)
        at beginWhiteSpace (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\sax\lib\sax.js:1022:7)
        at SAXParser.write (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\sax\lib\sax.js:1079:11)
        at Parser.exports.Parser.Parser.parseString (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\xml2js\lib\parser.js:337:31)
        at Parser.parseString (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\xml2js\lib\parser.js:5:59)
        at C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\xml2js\lib\parser.js:352:24
        at new Promise (<anonymous>)
        at Parser.exports.Parser.Parser.parseStringPromise (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\xml2js\lib\parser.js:350:14)
        at Parser.parseStringPromise (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\node_modules\xml2js\lib\parser.js:5:59)
        at parseStringPromise (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\pagseguro-functions.ts:65:35)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at Object.<anonymous> (C:\Necxu\projects\medicamenta.me\applications\medicamenta.me-back-functions\src\__tests__\pagseguro\createPagSeguroSubscription.test.ts:315:7)

    [0m [90m 91 |[39m     } [36mcatch[39m (error) {
     [90m 92 |[39m       [36mconst[39m errorMessage [33m=[39m error [36minstanceof[39m [33mError[39m [33m?[39m error[33m.[39mmessage [33m:[39m [32m'Unknown error'[39m[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m       console[33m.[39merror([32m'Error creating PagSeguro subscription:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 94 |[39m       [36mthrow[39m [36mnew[39m functions[33m.[39mhttps[33m.[39m[33mHttpsError[39m([32m'internal'[39m[33m,[39m errorMessage)[33m;[39m
     [90m 95 |[39m     }
     [90m 96 |[39m   }[0m

      at error (src/pagseguro-functions.ts:93:15)
      at Object.<anonymous> (src/__tests__/pagseguro/createPagSeguroSubscription.test.ts:315:7)

PASS src/__tests__/pagseguro/createPagSeguroSubscription.test.ts (55.118 s)
  ≡ƒƒó PagSeguro Functions - createPagSeguroSubscription
    Γ£à Cen├írios Positivos
      ΓêÜ deve criar subscription PagSeguro com sucesso (1981 ms)
      ΓêÜ deve incluir URL de checkout sandbox correta (78 ms)
    Γ¥î Cen├írios Negativos
      ΓêÜ deve retornar erro se n├úo autenticado (60 ms)
      ΓêÜ deve retornar erro se planCode ausente (66 ms)
      ΓêÜ deve retornar erro se customer ausente (35 ms)
      ΓêÜ deve retornar erro se PagSeguro API falhar (132 ms)
    ΓÜá∩╕Å Edge Cases
      ΓêÜ deve lidar com timeout da API PagSeguro (31066 ms)
      ΓêÜ deve lidar com resposta XML malformada (60 ms)

-------------------------|---------|----------|---------|---------|-----------------------------
File                     | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s           
-------------------------|---------|----------|---------|---------|-----------------------------
All files                |   81.91 |    74.74 |   84.45 |   81.62 |                             
 src                     |   62.57 |     57.1 |   58.49 |   62.51 |                             
  index.ts               |       0 |        0 |       0 |       0 | 1-439                       
  ocr-cloud-vision.ts    |   97.18 |    82.25 |     100 |   97.14 | 135,163                     
  pagseguro-functions.ts |   98.15 |    76.41 |     100 |   98.15 | 254-255,274                 
  pagseguro.ts           |       0 |        0 |       0 |       0 | 11-413                      
  stripe-functions.ts    |   96.02 |    81.05 |     100 |   96.02 | 187-188,210-211,275-276,333 
 src/api                 |     100 |       50 |     100 |     100 |                             
  index.ts               |     100 |       50 |     100 |     100 | 38                          
 src/api/middleware      |   98.81 |    95.77 |      96 |    98.8 |                             
  api-key-validator.ts   |     100 |    89.47 |     100 |     100 | 190-210                     
  auth.ts                |     100 |      100 |     100 |     100 |                             
  error-handler.ts       |     100 |      100 |     100 |     100 |                             
  logger.ts              |     100 |      100 |     100 |     100 |                             
  rate-limiter.ts        |      95 |       95 |      80 |      95 | 142,161                     
 src/api/utils           |     100 |      100 |     100 |     100 |                             
  api-error.ts           |     100 |      100 |     100 |     100 |                             
 src/api/v1              |   98.23 |    95.72 |     100 |   98.15 |                             
  adherence.routes.ts    |     100 |    95.74 |     100 |     100 | 63,243                      
  auth.routes.ts         |   97.46 |     90.9 |     100 |   97.46 | 113,127                     
  medications.routes.ts  |   98.83 |    97.72 |     100 |    98.8 | 135                         
  patients.routes.ts     |    98.9 |      100 |     100 |   98.87 | 158                         
  reports.routes.ts      |   97.14 |       92 |     100 |   96.96 | 86,143                      
  webhooks.routes.ts     |   96.51 |       96 |     100 |   96.38 | 119,269-270                 
-------------------------|---------|----------|---------|---------|-----------------------------
Jest: "global" coverage threshold for branches (80%) not met: 74.74%
Test Suites: 31 passed, 31 total
Tests:       432 passed, 432 total
Snapshots:   0 total
Time:        69.123 s
Ran all test suites.
